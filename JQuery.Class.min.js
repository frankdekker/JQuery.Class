(function(){this.Class=function(b){b=b||{};var c=function(){for(var b in this){var a=this[b];switch($.type(a)){case "object":this[b]=$.extend(!0,{},a);break;case "array":this[b]=$.extend(!0,[],a)}}return this.initialize?this.initialize.apply(this,arguments):this};c.$definition=b;a(c.prototype,b);c.prototype.parentMethod=function(){try{if(arguments.callee.caller===this.$parent)return window.console&&console.error("This function has no parent."),!1}catch(b){}return this.$parent.apply(this,arguments)};
return c};var a=function(b,c){for(var d in c)!1!==c.hasOwnProperty(d)&&void 0!==c[d]&&("Extends"===d?$.each("array"===$.type(c.Extends)?c.Extends:[c.Extends],function(){a(b,this.$definition)}):$.isFunction(b[d])&&$.isFunction(c[d])?b[d]=e(c[d],b[d]):b[d]=c[d])},e=function(b,a){return function(){var e=this.$parent;this.$parent=a;var f=b.apply(this,arguments);this.$parent=e;return f}}})();(function(){var a=function(a){return a.replace(/^on([A-Z])/,function(a,c){return c.toLowerCase()})};this.Chain=new Class({$chains:[],chain:function(a){this.$chains.push(a);return this},callChain:function(a){if(0==this.$chains.length)return this;var b=this.$chains.shift();"function"==typeof b&&b.apply(this,arguments);return this},clearChain:function(){this.$chains=[];return this}});this.Events=new Class({$events:{},on:function(e,b){e=a(e);var c=this.$events[e]||[];0>$.inArray(c,b)&&(c.push(b),this.$events[e]=
c);return this},off:function(e,b){e=a(e);var c=this.$events[e];if(c)if(void 0==b)delete this.$events[e];else{var d=c.indexOf(b);-1!=d&&delete c[d]}return this},trigger:function(e,b){var c,d;e=a(e);c=this.$events[e];if(!c)return this;b=$.isArray(b)?b:[b];for(d=0;d<c.length;d++)c[d]&&c[d].apply(this,b);return this}});this.Options=new Class({setOptions:function(){var a=this.options=$.extend.apply(null,$.merge([{},this.options],arguments));if(this.on)for(var b in a)"function"==$.type(a[b])&&/^on[A-Z]/.test(b)&&
(this.on(b,a[b]),delete a[b]);return this}})})();(function(){this.Drag=new Class({Extends:[Events,Options],element:null,options:{snap:10,preventDefault:!1,stopPropagation:!1},bound:{},mouse:{},initialize:function(a,e){this.element=a;this.setOptions(e);this.bound={start:$.proxy(this.start,this),check:$.proxy(this.check,this),drag:$.proxy(this.drag,this),cancel:$.proxy(this.cancel,this),stop:$.proxy(this.stop,this)};this.attach()},attach:function(){this.element.on("touchstart mousedown",this.bound.start);return this},detach:function(){this.element.off("touchstart mousedown",
this.bound.start);return this},start:function(a){this.options.preventDefault&&a.preventDefault();this.options.stopPropagation&&a.stopPropagation();a=this.getPoint(a);this.mouse.start=a;this.trigger("beforeStart",[this.element,a]);$(document).on("mousemove touchmove",this.bound.check).on("mouseup touchend touchcancel",this.bound.cancel)},check:function(a){a=this.getPoint(a);Math.round(Math.sqrt(Math.pow(a.x-this.mouse.start.x,2)+Math.pow(a.y-this.mouse.start.y,2)))<=this.options.snap||($(document).off("mousemove touchmove",
this.bound.check).off("mouseup touchend touchcancel",this.bound.cancel).on("mousemove touchmove",this.bound.drag).on("mouseup touchend touchcancel",this.bound.stop),this.trigger("start",[this.element,a]))},drag:function(a){this.trigger("drag",[this.element,this.getPoint(a),this.mouse.start])},cancel:function(a){$(document).off("mousemove touchmove",this.bound.check).off("mouseup touchend touchcancel",this.bound.cancel);this.trigger("cancel",[this.element,this.getPoint(a)])},stop:function(a){$(document).off("mousemove touchmove",
this.bound.drag).off("mouseup touchend touchcancel",this.bound.stop);this.trigger("complete",[this.element,this.getPoint(a),this.mouse.start])},getPoint:function(a){return a.originalEvent&&a.originalEvent.touches?{x:a.originalEvent.touches[0].pageX,y:a.originalEvent.touches[0].pageY}:{x:a.pageX,y:a.pageY}}})})();
