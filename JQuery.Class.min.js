(function(){this.Class=function(a){a=a||{};var c=function(){for(var a in this){var c=this[a];switch($.type(c)){case "object":this[a]=$.extend(!0,{},c);break;case "array":this[a]=$.extend(!0,[],c)}}return this.initialize?this.initialize.apply(this,arguments):this};c.$definition=a;b(c.prototype,a);c.prototype.parentMethod=function(){try{if(arguments.callee.caller===this.$parent)return window.console&&console.error("This function has no parent."),!1}catch(a){}return this.$parent.apply(this,arguments)};
return c};var b=function(e,c){for(var d in c)!1!==c.hasOwnProperty(d)&&void 0!==c[d]&&("Extends"===d?$.each("array"===$.type(c.Extends)?c.Extends:[c.Extends],function(){b(e,this.$definition)}):$.isFunction(e[d])&&$.isFunction(c[d])?e[d]=a(c[d],e[d]):e[d]=c[d])},a=function(a,c){return function(){var b=this.$parent;this.$parent=c;var f=a.apply(this,arguments);this.$parent=b;return f}}})();(function(){var b=function(a){return a.replace(/^on([A-Z])/,function(a,c){return c.toLowerCase()})};this.Chain=new Class({$chains:[],chain:function(a){this.$chains.push(a);return this},callChain:function(a){if(0==this.$chains.length)return this;var b=this.$chains.shift();"function"==typeof b&&b.apply(this,arguments);return this},clearChain:function(){this.$chains=[];return this}});this.Events=new Class({$events:{},on:function(a,e){a=b(a);var c=this.$events[a]||[];0>$.inArray(c,e)&&(c.push(e),this.$events[a]=
c);return this},off:function(a,e){a=b(a);var c=this.$events[a];if(c)if(void 0==e)delete this.$events[a];else{var d=c.indexOf(e);-1!=d&&delete c[d]}return this},trigger:function(a,e){var c,d;a=b(a);c=this.$events[a];if(!c)return this;e=$.isArray(e)?e:[e];for(d=0;d<c.length;d++)c[d]&&c[d].apply(this,e);return this}});this.Options=new Class({setOptions:function(){var a=this.options=$.extend.apply(null,$.merge([{},this.options],arguments));if(this.on)for(var b in a)"function"==$.type(a[b])&&/^on[A-Z]/.test(b)&&
(this.on(b,a[b]),delete a[b]);return this}})})();(function(){this.Drag=new Class({Extends:[Events,Options],element:null,options:{snap:10,preventDefault:!1,stopPropagation:!1},bound:{},mouse:{},initialize:function(b,a){this.element=b;this.setOptions(a);this.bound={start:$.proxy(this.start,this),check:$.proxy(this.check,this),drag:$.proxy(this.drag,this),cancel:$.proxy(this.cancel,this),stop:$.proxy(this.stop,this)};this.attach()},attach:function(){this.element.on("touchstart mousedown",this.bound.start);return this},detach:function(){this.element.off("touchstart mousedown",
this.bound.start);return this},start:function(b){this.options.preventDefault&&b.preventDefault();this.options.stopPropagation&&b.stopPropagation();var a=this.getPoint(b);this.mouse.start=a;this.trigger("beforeStart",[this.element,a,b]);$(document).on("mousemove touchmove",this.bound.check).on("mouseup touchend touchcancel",this.bound.cancel)},check:function(b){var a=this.getPoint(b);Math.round(Math.sqrt(Math.pow(a.x-this.mouse.start.x,2)+Math.pow(a.y-this.mouse.start.y,2)))<=this.options.snap||($(document).off("mousemove touchmove",
this.bound.check).off("mouseup touchend touchcancel",this.bound.cancel).on("mousemove touchmove",this.bound.drag).on("mouseup touchend touchcancel",this.bound.stop),this.trigger("start",[this.element,a,b]))},drag:function(b){this.trigger("drag",[this.element,this.getPoint(b),this.mouse.start,b])},cancel:function(b){$(document).off("mousemove touchmove",this.bound.check).off("mouseup touchend touchcancel",this.bound.cancel);this.trigger("cancel",[this.element,this.getPoint(b),this.mouse.start,b])},
stop:function(b){$(document).off("mousemove touchmove",this.bound.drag).off("mouseup touchend touchcancel",this.bound.stop);this.trigger("complete",[this.element,this.getPoint(b),this.mouse.start,b])},getPoint:function(b){return b.originalEvent&&b.originalEvent.touches?{x:b.originalEvent.touches[0].pageX,y:b.originalEvent.touches[0].pageY}:{x:b.pageX,y:b.pageY}}})})();
